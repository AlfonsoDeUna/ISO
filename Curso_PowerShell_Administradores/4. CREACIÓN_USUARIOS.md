# CREACIÓN DE USAURIOS LOCALES CON POWERSHELL


## INTRO: Obtener información de usuarios locales

```powershell
Get-LocalUser | Select-Object Name, Enabled, LastLogon | Format-Table

```

## 1. Crear un usuario con contraseña básica

Para crear un usuario, primero debemos generar un objeto de contraseña segura, ya que PowerShell no permite pasar contraseñas en texto plano por motivos de seguridad.

```powershell
# 1. Solicitar contraseña de forma segura
$Password = Read-Host "Introduce la contraseña" -AsSecureString

# 2. Crear el usuario
New-LocalUser -Name "TecnicoSoporte" -Password $Password -FullName "Juan Pérez" -Description "Cuenta para soporte técnico"

```

## 2. Crear un usuario que deba cambiar contraseña al iniciar

Es la mejor práctica administrativa: tú creas la cuenta, pero el usuario elige su clave privada al entrar.

```powershell
$Pass = Read-Host "Password temporal" -AsSecureString

New-LocalUser -Name "UsuarioTemporal" `
              -Password $Pass `
              -PasswordNeverExpires $false `
              -ChangePasswordAtLogon $true

# OTRA FORMA CON ARRAYS

$Password = Read-Host -AsSecureString
$params = @{
    Name        = 'User03'
    Password    = $Password
    FullName    = 'Third User'
    Description = 'Description of this account.'
}
New-LocalUser @params

```


## 3. Crear un usuario deshabilitado (Pre-provisión)

Útil cuando sabes que alguien se incorporará la próxima semana pero no quieres la cuenta activa aún.

```powershell
New-LocalUser -Name "NuevoEmpleado" -Disabled

```


## 4. Gestión Completa: Crear y asignar a un Grupo

Crear el usuario es solo la mitad del trabajo; normalmente necesitas que sea **Administrador** o **Usuario estándar**. Para esto usamos el pipe `|` o el nombre del usuario creado.

```powershell
# Crear el usuario y guardarlo en una variable
$usuario = New-LocalUser -Name "AdminLocal2" -Password (Read-Host -AsSecureString)

# Añadirlo al grupo de Administradores
Add-LocalGroupMember -Group "Administradores" -Member $usuario

```

## 5. Script de creación masiva (Automatización)

Como administrador, a veces recibes una lista de nombres. PowerShell brilla aquí:

```powershell
$nombres = @("Ana", "Pedro", "Maria")
$pass = ConvertTo-SecureString "Pass1234!" -AsPlainText -Force

foreach ($nombre in $nombres) {
    New-LocalUser -Name $nombre -Password $pass -Description "Usuario creado por script"
    Write-Host "Usuario $nombre creado con éxito." -ForegroundColor Green
}

```

## Resumen de Parámetros Clave

| Parámetro | Descripción |
| --- | --- |
| `-AccountExpires` | Define una fecha de caducidad para la cuenta (ej. contratos temporales). |
| `-PasswordNeverExpires` | Si se pone en `$true`, la clave no caduca nunca (útil para cuentas de servicio). |
| `-FullName` | El nombre real que aparecerá en la pantalla de bloqueo. |
| `-NoPassword` | Crea una cuenta sin contraseña (no recomendado por seguridad). |

---

### Siguiente paso para tu GitHub

¿Te gustaría que te explique cómo **modificar** estos usuarios una vez creados (cambiar contraseñas, bloquear cuentas o renombrarlas) usando `Set-LocalUser`?

## 7. Modificación de Usuarios (`Set-LocalUser`)

Este cmdlet se usa para cambiar los atributos de una cuenta ya existente.

### Cambiar la descripción o el nombre completo

```powershell
Set-LocalUser -Name "TecnicoSoporte" -Description "Soporte Nivel 2 - Turno Tarde" -FullName "Juan Pérez García"

```

### Deshabilitar o Habilitar una cuenta

Ideal para bajas temporales o vacaciones largas por seguridad.

```powershell
# Bloquear acceso
Set-LocalUser -Name "UsuarioTemporal" -Disabled $true

# Desbloquear acceso
Set-LocalUser -Name "UsuarioTemporal" -Disabled $false

```

---

## 8. Reseteo de Contraseñas

Como administrador, esta será una de tus tareas más frecuentes. Recuerda que siempre necesitamos convertir el texto plano a `SecureString`.

```powershell
$NuevaClave = Read-Host "Introduce la nueva contraseña" -AsSecureString
Set-LocalUser -Name "TecnicoSoporte" -Password $NuevaClave

```

---

## 9. Gestión de Grupos Locales (`LocalGroup`)

Un usuario no sirve de mucho si no tiene permisos. Los grupos definen qué puede hacer el usuario en el sistema.

| Cmdlet | Acción |
| --- | --- |
| `Get-LocalGroup` | Lista todos los grupos del equipo (Administradores, Usuarios, Invitados...). |
| `Get-LocalGroupMember` | Muestra quién está dentro de un grupo específico. |
| `Add-LocalGroupMember` | Añade un usuario a un grupo. |
| `Remove-LocalGroupMember` | Quita a un usuario de un grupo. |

### Ejemplo: Convertir a un usuario en Administrador

```powershell
Add-LocalGroupMember -Group "Administradores" -Member "TecnicoSoporte"

```

### Ejemplo: Ver quién tiene permisos de Admin

```powershell
Get-LocalGroupMember -Group "Administradores" | Select-Object Name, PrincipalSource

```

---

## 10. Eliminación de Cuentas (`Remove-LocalUser`)

Cuando una cuenta ya no es necesaria, se elimina de forma definitiva. **Cuidado:** Esto no borra la carpeta del perfil en `C:\Users`, solo la cuenta de acceso.

```powershell
Remove-LocalUser -Name "UsuarioTemporal"

```


